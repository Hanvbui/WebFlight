<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>Q Airlines Website</title>

    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="passengerInfo.css" />
  </head>
    <!-- Header -->
    <header class="header1">
      <div class="container1">
        <div class="logo-container1">
            <a href="index.html">  <!-- bám vào logo quay về trang chủ -->  
            <img
              alt="Logo Q Airlines"
              class="logo1"
              src="images-airplane/logo_icon_final.png"
            />
          </a>
        </div>
        <div class="header-right1">
          <a href="login.html">Đăng nhập</a>
          <a href="register.html">Đăng ký</a>
          <a href="FAQ.html">Trợ giúp <i class="fas fa-info-circle"></i></a>
        </div>
      </div>
    </header>

    <!-- Navbar -->
    <div class="navbar">
      <div class="dropdown">
        <a href="index.html">Chuyến bay <i class="fas fa-chevron-down"></i></a>
        <div class="dropdown-menu">
          <a href="arrival-destinations.html" class="dropdown-item">Điểm đến</a>
          <a href="lich-bay.html" class="dropdown-item">Lịch bay</a>
          <a href="Offers.html" class="dropdown-item">Ưu đãi</a>
        </div>
      </div>

      <div class="dropdown">
        <a href="#">Thông tin hành trình <i class="fas fa-chevron-down"></i></a>
        <div class="dropdown-menu">
          <a href="check-in.html" class="dropdown-item">Check-in</a>
          <a href="Airport Informations.html" class="dropdown-item">Thông tin sân bay</a>
          <a href="cbct.html" class="dropdown-item">Chuyến bay của tôi</a>
        </div>
      </div>

      <div class="dropdown">
        <a href="#">Dịch vụ <i class="fas fa-chevron-down"></i></a>
        <div class="dropdown-menu">
          <a href="Support Services.html" class="dropdown-item">Dịch vụ hỗ trợ</a>
          <a href="Special Services.html" class="dropdown-item">Dịch vụ đặc biệt</a>
        </div>
      </div>

      <div class="dropdown">
        <a href="index.html">Mua vé <i class="fas fa-chevron-down"></i></a>
        <div class="dropdown-menu">
          <a href="index.html" class="dropdown-item">Đặt mua</a>
          <a href="Purchase Instructions.html" class="dropdown-item">Hướng dẫn mua</a>
          <a href="Payments.html" class="dropdown-item">Thanh toán</a>
          <a href="Taxes-Fees-Surcharges.html" class="dropdown-item">Thuế - Lệ phí</a>
          <a href="Taxes-Fees-Surcharges.html" class="dropdown-item">Phụ thu</a>
        </div>
      </div>
    </div>

    
    <div class="form-container">
<form id="passenger-form">
    <div>
        <label>
            <input type="radio" name="class" value="1" checked>
            Economy
        </label>
        <label>
            <input type="radio" name="class" value="2">
            Business
        </label>
    </div>
    <div id="passenger-list"></div>
    <button type="submit">Đặt vé</button>
</form>
    </div>
<!-- Footer -->
<footer class="footer" style="background-image: url(images-airplane/site-footer-shape-1.png)">
  <div class="container">
    <div class="footer-grid">
      <!-- Liên kết nhanh -->
      <div class="footer-section">
        <h3 class="footer-title">Liên kết nhanh</h3>
        <ul class="footer-list">
          <li><a href="index.html" class="footer-link">Trang chủ</a></li>
          <li><a href="index.html" class="footer-link">Chuyến bay</a></li>
          <li><a href="index.html" class="footer-link">Mua vé</a></li>
          <li><a href="index.html" class="footer-link">Thông tin hành trình</a></li>
          <li><a href="index.html" class="footer-link">Dịch vụ khách hàng</a></li>
        </ul>
      </div>

      <!-- Liên hệ -->
      <div class="footer-section">
        <h3 class="footer-title">Liên hệ</h3>
        <ul class="footer-list">
          <li>
            Email:
            <a href="mailto:support@baae.com" class="footer-link"
              >support@qairline.com</a
            >
          </li>
          <li>
            Điện thoại:
            <a href="tel:+84912345678" class="footer-link">+84 123456789</a>
          </li>
          <li>Địa chỉ: 40 Hàng Bài, Hoàn Kiếm, Hà Nội</li>
        </ul>
      </div>

<!-- Chính sách và điều khoản -->
<div class="footer-section">
<h3 class="footer-title">Chính sách</h3>
<ul class="footer-list">
<li><a href="Privacy Policy.html" class="footer-link">Chính sách bảo mật</a></li>
<li><a href="Term of Services.html" class="footer-link">Điều khoản dịch vụ</a></li>
<li><a href="Refund Policy.html" class="footer-link">Chính sách hoàn tiền</a></li>
<li>
  <a href="FAQ.html" class="footer-link">FAQ (Câu hỏi thường gặp)</a>
</li>
</ul>
</div>
      <!-- Mạng xã hội -->
      <div class="footer-section">
        <h3 class="footer-title">Kết nối với chúng tôi</h3>
        <div class="social-links">
          <a
            href="https://facebook.com"
            target="_blank"
            class="social-link facebook"
            ><i class="fab fa-facebook-f"></i
          ></a>
          <a
            href="https://twitter.com"
            target="_blank"
            class="social-link twitter"
            ><i class="fab fa-twitter"></i
          ></a>
          <a
            href="https://instagram.com"
            target="_blank"
            class="social-link instagram"
            ><i class="fab fa-instagram"></i
          ></a>
          <a
            href="https://linkedin.com"
            target="_blank"
            class="social-link linkedin"
            ><i class="fab fa-linkedin-in"></i
          ></a>
        </div>
      </div>
    </div>

    <div class="footer-bottom">
      <p>&copy; 2024 QAirline. Tất cả quyền lợi được bảo lưu.</p>
    </div>
  </div>
</footer>

<script>
    const passengerCount = sessionStorage.getItem('passengerCount'); 
    const outboundFlight = sessionStorage.getItem('outboundFlight');
    const returnFlight = sessionStorage.getItem('returnFlight');
    const isRoundTrip = !!(outboundFlight && returnFlight);


    console.log('Outbound Flight ID:', outboundFlight);  // Check for valid values
    console.log('Return Flight ID:', returnFlight);
    console.log('Passenger Count:', passengerCount);

    const passengerList = document.getElementById('passenger-list');
    for (let i = 0; i < passengerCount; i++) {
        const passengerDiv = document.createElement('div');
        passengerDiv.innerHTML = `
            <h3>Hành khách ${i + 1}</h3>
            <input type="text" placeholder="Họ tên" name="name${i}" required />
            <input type="text" placeholder="Tên đệm" name="mname${i}" />
            <input type="number" placeholder="Tuổi" name="age${i}" required />
            <input type="email" placeholder="Email" name="email${i}" required />
        `;
        passengerList.appendChild(passengerDiv);
    }

    document.getElementById('passenger-form').onsubmit = (e) => {
    e.preventDefault();

    const passengerInfo = [];
    const passengerList = document.getElementById('passenger-list');

    // Duyệt qua tất cả các div trong passenger-list
    for (let i = 0; i < passengerCount; i++) {
        const passengerDiv = passengerList.children[i];
        
        // Lấy thông tin hành khách từ các input trong div
        const name = passengerDiv.querySelector('[name="name' + i + '"]').value;
        const mname = passengerDiv.querySelector('[name="mname' + i + '"]').value;
        const age = passengerDiv.querySelector('[name="age' + i + '"]').value;
        const email = passengerDiv.querySelector('[name="email' + i + '"]').value;

        // Thêm vào array thông tin hành khách
        passengerInfo.push({ name, mname, age, email });
    }

      // Lấy thông tin loại vé (class) trực tiếp từ form
      const classId = document.querySelector('input[name="class"]:checked')?.value;


    const bookings = [];

    // Xử lý cho chuyến khứ hồi hoặc một chiều
    if (isRoundTrip) {
    bookings.push({ flight: sessionStorage.getItem('outboundFlight'), passengers: passengerInfo, classId });
    bookings.push({ flight: sessionStorage.getItem('returnFlight'), passengers: passengerInfo, classId });
} else {
    bookings.push({ flight: sessionStorage.getItem('selectedFlight'), passengers: passengerInfo, classId });
}

console.log('Bookings:', bookings);


    // Gửi yêu cầu POST đến server
    fetch('/createBooking', {
        method: 'POST',
        body: JSON.stringify(bookings),
        headers: { 'Content-Type': 'application/json' },
    })
    .then(response => response.json())
    .then(data => {
        if (data.error) {
            alert('Đặt vé thất bại: ' + data.error);
        } else {
            alert(`Đặt vé thành công! Mã booking của bạn là: ${data.bookingIds.join(', ')}`);
            sessionStorage.setItem('bookingIds', JSON.stringify(data.bookingIds));
        }
    })
    .catch(error => {
        console.error('Có lỗi xảy ra:', error);
        alert('Đặt vé thất bại!');
    });
};

</script>

  </body>